<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Intermediador entre arquivos .docx e IA externa — preserva estrutura e permite edição de conteúdo textual via JSON">
    <title>DOC IA Editor — Intermediador .docx ↔ IA</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/css/styles.css">
</head>

<body>
    <!-- ─── Background ────────────────────────────────── -->
    <div class="bg-gradient" aria-hidden="true"></div>
    <div class="bg-grid" aria-hidden="true"></div>

    <!-- ─── Header ────────────────────────────────────── -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <div class="logo-icon">
                    <svg viewBox="0 0 40 40" fill="none">
                        <rect x="4" y="6" width="24" height="30" rx="3" stroke="currentColor" stroke-width="2" />
                        <path d="M10 14h12M10 19h12M10 24h8" stroke="currentColor" stroke-width="1.5"
                            stroke-linecap="round" />
                        <path d="M22 18l10-10M32 8l-4 0l0 4" stroke="url(#arrow-grad)" stroke-width="2"
                            stroke-linecap="round" stroke-linejoin="round" />
                        <defs>
                            <linearGradient id="arrow-grad" x1="22" y1="18" x2="32" y2="8">
                                <stop stop-color="#007AFF" />
                                <stop offset="1" stop-color="#34C759" />
                            </linearGradient>
                        </defs>
                    </svg>
                </div>
                <div>
                    <h1 class="logo-title">DOC IA Editor</h1>
                    <p class="logo-subtitle">Intermediador .docx ↔ IA</p>
                </div>
            </div>
            <div class="header-actions">
                <button id="btn-help" class="btn btn-ghost" type="button" title="Ajuda">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10" />
                        <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3" />
                        <line x1="12" y1="17" x2="12.01" y2="17" />
                    </svg>
                    Ajuda
                </button>
            </div>
        </div>
    </header>

    <main class="main">
        <!-- ─── Step 1: Upload ────────────────────────── -->
        <section class="step-section" id="section-upload">
            <div class="step-header">
                <span class="step-number">1</span>
                <div>
                    <h2 class="step-title">Enviar Documento</h2>
                    <p class="step-desc">Faça upload do seu arquivo .docx para extrair a estrutura</p>
                </div>
            </div>
            <div class="upload-area" id="upload-area">
                <input type="file" id="file-input" accept=".docx" hidden>
                <div class="upload-icon">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="17 8 12 3 7 8" />
                        <line x1="12" y1="3" x2="12" y2="15" />
                    </svg>
                </div>
                <p class="upload-text">Arraste um arquivo <strong>.docx</strong> aqui</p>
                <p class="upload-text-alt">ou clique para selecionar</p>
                <div class="upload-file-info" id="upload-file-info" hidden>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                        <polyline points="14 2 14 8 20 8" />
                    </svg>
                    <span id="file-name-display"></span>
                </div>
            </div>
        </section>

        <!-- ─── Step 2: AI Transform ─────────────────── -->
        <section class="step-section" id="section-json" hidden>
            <div class="step-header">
                <span class="step-number">2</span>
                <div>
                    <h2 class="step-title">Editar Conteúdo</h2>
                    <p class="step-desc">Escreva a documentação e a IA transforma automaticamente</p>
                </div>
            </div>

            <!-- AI Integration Panel -->
            <div class="ai-panel">
                <div class="ai-panel-header">
                    <h3 class="panel-title">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                        </svg>
                        Transformar com IA
                    </h3>
                    <div class="api-key-group">
                        <select id="ai-provider" class="provider-select">
                            <option value="openrouter">OpenRouter / DeepSeek (grátis)</option>
                            <option value="openai">OpenAI / ChatGPT</option>
                        </select>
                        <div class="api-key-wrapper">
                            <input type="password" id="api-key-input" class="api-key-field"
                                placeholder="API Key do OpenRouter" autocomplete="off" />
                            <button id="btn-toggle-key" class="btn-icon" type="button" title="Mostrar/ocultar">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z" />
                                    <circle cx="12" cy="12" r="3" />
                                </svg>
                            </button>
                        </div>
                        <a id="api-key-link" href="https://aistudio.google.com/apikey" target="_blank" rel="noopener"
                            class="api-key-link">Obter chave grátis →</a>
                    </div>
                </div>
                <textarea id="user-text" class="user-textarea" spellcheck="true"
                    placeholder="Escreva aqui a documentação em linguagem normal...&#10;&#10;Exemplo:&#10;DOCUMENTO DE ESPECIFICAÇÃO&#10;Administração de Usuários&#10;&#10;1. Objetivo&#10;Descrever as funcionalidades da tela...&#10;&#10;2. Atividades&#10;2.1 - Barra de Ações&#10;Localizada na parte superior..."></textarea>
                <div class="ai-actions">
                    <button id="btn-transform" class="btn btn-primary btn-transform" type="button" disabled>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2">
                            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />
                        </svg>
                        Transformar com IA
                    </button>
                    <span class="ai-hint">Gemini 2.0 Flash · Gratuito · Até 15 req/min</span>
                </div>
            </div>

            <!-- Divider -->
            <div class="divider-or"><span>ou edite o JSON manualmente</span></div>

            <!-- Manual JSON (collapsible) -->
            <details class="manual-section" id="manual-section">
                <summary class="manual-toggle">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="6 9 12 15 18 9" />
                    </svg>
                    Edição manual do JSON
                </summary>
                <div class="json-grid">
                    <div class="json-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                    <polyline points="14 2 14 8 20 8" />
                                </svg>
                                JSON Original
                            </h3>
                            <button id="btn-copy" class="btn btn-sm btn-accent" type="button">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                                </svg>
                                Copiar
                            </button>
                        </div>
                        <div class="json-stats" id="json-stats"></div>
                        <textarea id="json-original" class="json-textarea" readonly spellcheck="false"
                            placeholder="O JSON extraído aparecerá aqui..."></textarea>
                    </div>
                    <div class="json-panel">
                        <div class="panel-header">
                            <h3 class="panel-title">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7" />
                                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z" />
                                </svg>
                                JSON Modificado
                            </h3>
                            <button id="btn-paste" class="btn btn-sm btn-accent" type="button">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                    stroke-width="2">
                                    <path
                                        d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2" />
                                    <rect x="8" y="2" width="8" height="4" rx="1" ry="1" />
                                </svg>
                                Colar
                            </button>
                        </div>
                        <textarea id="json-modified" class="json-textarea" spellcheck="false"
                            placeholder="Cole aqui o JSON modificado pela IA..."></textarea>
                    </div>
                </div>
            </details>
        </section>

        <!-- ─── Step 3: Actions ───────────────────────── -->
        <section class="step-section" id="section-actions" hidden>
            <div class="step-header">
                <span class="step-number">3</span>
                <div>
                    <h2 class="step-title">Validar e Gerar</h2>
                    <p class="step-desc">Valide a estrutura e gere o novo documento .docx</p>
                </div>
            </div>
            <div class="action-buttons">
                <button id="btn-validate" class="btn btn-secondary" type="button">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="9 11 12 14 22 4" />
                        <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
                    </svg>
                    Validar JSON
                </button>
                <button id="btn-generate" class="btn btn-primary" type="button" disabled>
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                        <polyline points="7 10 12 15 17 10" />
                        <line x1="12" y1="15" x2="12" y2="3" />
                    </svg>
                    Gerar DOCX
                </button>
                <button id="btn-reset" class="btn btn-ghost" type="button">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="1 4 1 10 7 10" />
                        <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10" />
                    </svg>
                    Recomeçar
                </button>
            </div>
        </section>

        <!-- ─── Messages ──────────────────────────────── -->
        <div id="messages-container" class="messages-container" hidden></div>
    </main>

    <!-- ─── Help Modal ────────────────────────────────── -->
    <div id="help-modal" class="modal" hidden>
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Como usar com IA</h2>
                <button id="btn-close-help" class="btn-close" type="button" aria-label="Fechar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18" />
                        <line x1="6" y1="6" x2="18" y2="18" />
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="help-steps">
                    <div class="help-step">
                        <div class="help-step-num">1</div>
                        <div>
                            <h3>Faça upload do seu .docx</h3>
                            <p>O sistema extrai automaticamente a estrutura do documento em formato JSON.</p>
                        </div>
                    </div>
                    <div class="help-step">
                        <div class="help-step-num">2</div>
                        <div>
                            <h3>Copie o JSON extraído</h3>
                            <p>Use o botão "Copiar" para copiar todo o JSON para a área de transferência.</p>
                        </div>
                    </div>
                    <div class="help-step">
                        <div class="help-step-num">3</div>
                        <div>
                            <h3>Envie para a IA (ChatGPT, Claude, etc.)</h3>
                            <p>Cole o JSON junto com o prompt abaixo. A IA poderá modificar textos, adicionar ou remover
                                blocos.</p>
                        </div>
                    </div>
                    <div class="help-step">
                        <div class="help-step-num">4</div>
                        <div>
                            <h3>Cole o JSON modificado</h3>
                            <p>Copie a resposta da IA e cole na área "JSON Modificado".</p>
                        </div>
                    </div>
                    <div class="help-step">
                        <div class="help-step-num">5</div>
                        <div>
                            <h3>Valide e gere o novo .docx</h3>
                            <p>O sistema validará a estrutura e gerará um novo documento preservando toda a formatação
                                original.</p>
                        </div>
                    </div>
                </div>

                <div class="prompt-section">
                    <h3>Prompt para usar com a IA</h3>
                    <p class="prompt-instruction">Copie o prompt abaixo e envie junto com o JSON para a IA:</p>
                    <div class="prompt-box">
                        <pre id="ai-prompt">Você é um formatador de documentos Word (.docx).

Recebo um JSON extraído de um documento original. Este JSON é a referência
de ESTRUTURA e ESTILO. Gere um JSON no MESMO FORMATO com o conteúdo solicitado,
seguindo o padrão de estilização do documento original.

═══ TIPOS DE BLOCOS ═══

"title"     → Título principal do documento
"table"     → Tabela com linhas e células
"heading"   → Seções numeradas (precisa de "level"):
              level 1: "1. OBJETIVO", "2. ATIVIDADES"
              level 2: "2.1 - Subseção"
              level 3: "2.1.1 - Detalhe"
"paragraph" → Texto normal
"list_item" → Itens de lista (precisa de "level": 1, 2...)

═══ FORMATAÇÃO INLINE (dentro do "text") ═══

Use markdown para formatação dentro do texto:
  **texto em negrito**
  *texto em itálico*
  ***negrito e itálico***

Exemplos:
  "text": "**2.1 - Cabeçalho da Seção**"
  "text": "O campo *Nome* é obrigatório."
  "text": "**Cancelar:** fecha sem salvar."

Use \n para quebra de linha e \t para tabulação.

═══ FORMATO DOS BLOCOS ═══

Título:    { "id": "block_0000", "type": "title", "text": "..." }
Heading:   { "id": "new_001", "type": "heading", "level": 1, "text": "**1. OBJETIVO**" }
Parágrafo: { "id": "new_002", "type": "paragraph", "text": "Texto..." }
Lista:     { "id": "new_003", "type": "list_item", "level": 1, "text": "Item" }
Tabela:    { "id": "block_0001", "type": "table", "rows": [[{"id":"...","text":"..."},...]] }

═══ REGRAS ═══

- SIGA o padrão de estilo do JSON original (ordem, tipos, formatação)
- Blocos existentes (IDs do original): manter ID, tipo e level
- Novos blocos: usar IDs únicos como "new_001", "new_002"
- NÃO incluir blocos vazios
- NÃO incluir imagens
- Atualizar blockCount e tableCount na metadata
- Se receber texto plano, estruturar automaticamente usando o padrão
  do documento original como referência de estilo

Responda APENAS com JSON puro.</pre>
                        <button id="btn-copy-prompt" class="btn btn-sm btn-accent" type="button">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2" />
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
                            </svg>
                            Copiar Prompt
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ─── Loading Overlay ───────────────────────────── -->
    <div id="loading-overlay" class="loading-overlay" hidden>
        <div class="spinner"></div>
        <p id="loading-text" class="loading-text">Processando...</p>
    </div>

    <script src="/js/app.js"></script>
</body>

</html>